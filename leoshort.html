<!DOCTYPE html>
<html>
<head>
  <title>Google Map Example</title>
  <script>
    function initMap() {
      // Create a new map centered on a specific location
      var map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 0, lng: 0},
        zoom: 2
      });
      
      // Read data from out_leosat_fm_step07.txt and plot markers on the map
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'out_leosat_fm_step07.txt');
      xhr.onload = function() {
        if (xhr.status === 200) {
          var data = xhr.responseText.split('\n');
          for (var i = 0; i < data.length; i++) {
            var line = data[i].split(', ');
            var date = new Date(line[0]);
            var callsign = line[1];
            var gridLocator = line[2];
            var latLng = {lat: parseFloat(line[3].substring(1, line[3].indexOf(','))), lng: parseFloat(line[3].substring(line[3].indexOf(',') + 2, line[3].length - 1))};
            var marker = new google.maps.Marker({
              position: latLng,
              map: map,
              icon: (Date.now() - date.getTime() <= 90 * 24 * 60 * 60 * 1000) ? 'img/fmicon_90.png' : 'img/fmicon_m90.png'
            });
          }
        }
      };
      xhr.send();
      
      // Read data from out_leosat_fm_step07_1.txt and plot markers on the map
      var xhr2 = new XMLHttpRequest();
      xhr2.open('GET', 'out_leosat_fm_step07_1.txt');
      xhr2.onload = function() {
        if (xhr2.status === 200) {
          var data = xhr2.responseText.split('\n');
          for (var i = 0; i < data.length; i++) {
            var line = data[i].split(', ');
            var date = new Date(line[0]);
            var callsign = line[1];
            var gridLocator = line[2];
            var latLng = {lat: parseFloat(line[3].substring(1, line[3].indexOf(','))), lng: parseFloat(line[3].substring(line[3].indexOf(',') + 2, line[3].length - 1))};
            var marker = new google.maps.Marker({
              position: latLng,
              map: map,
              icon: (Date.now() - date.getTime() <= 90 * 24 * 60 * 60 * 1000) ? 'img/m_30.png' : 'img/m_m30.png'
            });
          }
        }
      };
      xhr2.send();
    }
  </script>
</head>
<body onload="initMap()">
  <div id="map" style="height: 400px;"></div>
  <script async
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPRWRoTRhE5TddxBITIhBcKjdQpz2CXRs&callback=initMap&libraries=geometry">
  </script>
</body>
</html>
