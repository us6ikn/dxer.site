<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10GHz EME Stations Statistics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script> <!-- Annotation Plugin -->
    <script>
        // Fetch data from JSON files
        async function fetchData(file) {
            const response = await fetch(file);
            return await response.json();
        }

        // Function to extract antenna size (m) from antenna description
        function getAntennaSize(antennaStr) {
            let regex = /(\d+(\.\d+)?)(m|ft)/;
            let match = antennaStr.match(regex);
            if (match) {
                return parseFloat(match[1]);
            }
            return 0; // Default if no size is found
        }

        // Function to extract power (in W) from power description
        function getPower(powerStr) {
            let regex = /(\d+)(W|w)/;
            let match = powerStr.match(regex);
            if (match) {
                return parseInt(match[1]);
            }
            return 0; // Default if no power is found
        }

        // Helper function to compute the distribution of values (binned into specific ranges)
        function computeBinnedDistribution(values, ranges) {
            let bins = {};
            values.forEach(value => {
                let binRange = ranges.find(range => value >= range[0] && value < range[1]);
                if (binRange) {
                    let binLabel = `${binRange[0]}-${binRange[1]}`;
                    bins[binLabel] = (bins[binLabel] || 0) + 1;
                }
            });

            let total = values.length;
            let binnedDistribution = [];
            for (let bin in bins) {
                let percentage = (bins[bin] / total) * 100;
                binnedDistribution.push({ bin, percentage });
            }
            return binnedDistribution.sort((a, b) => {
                let aMin = parseFloat(a.bin.split('-')[0]);
                let bMin = parseFloat(b.bin.split('-')[0]);
                return aMin - bMin;
            });
        }

        // Setup the charts
        async function setupCharts() {
            // Load the two JSON files
            let data1 = await fetchData('output_2_10GHz.json');
            let data2 = await fetchData('output_2_10GHz_SK.json');
            let allData = [...data1, ...data2];

            // Get antenna sizes and power values
            let antennaSizes = allData.map(item => getAntennaSize(item.Antenna));
            let powerValues = allData.map(item => getPower(item.Power));

            // Log the extracted values to the console
            console.log("Extracted Antenna Sizes (m):", antennaSizes);
            console.log("Extracted Power Values (W):", powerValues);

            // Define new bin ranges for power and antenna (refined for smaller values)
            const powerRanges = [
                [1, 5],
                [5, 10],
                [10, 25],
                [25, 50],
                [50, 100],
                [100, 200],
                [200, 500],
                [500, 1000]
            ];

            const antennaRanges = [
                [0.3, 0.8],
                [0.8, 1],
                [1, 1.5],
                [1.5, 2],
                [2, 3],
                [3, 5],
                [5, 10]
            ];

            // Compute binned distributions
            let antennaDistribution = computeBinnedDistribution(antennaSizes, antennaRanges);
            let powerDistribution = computeBinnedDistribution(powerValues, powerRanges);

            // Prepare chart data (for shaded area, we'll use 'fill' in Chart.js)
            let antennaLabels = antennaDistribution.map(item => item.bin);
            let antennaData = antennaDistribution.map(item => item.percentage);

            let powerLabels = powerDistribution.map(item => item.bin);
            let powerData = powerDistribution.map(item => item.percentage);

            // Antenna Size Distribution Chart
            new Chart(document.getElementById('antennaChart'), {
                type: 'line',
                data: {
                    labels: antennaLabels,
                    datasets: [{
                        label: 'Antenna Size Distribution (%)',
                        data: antennaData,
                        fill: true, // Creates a shaded area under the line
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true, ticks: { stepSize: 10 } }
                    }
                }
            });

            // Power Distribution Chart
            new Chart(document.getElementById('powerChart'), {
                type: 'line',
                data: {
                    labels: powerLabels,
                    datasets: [{
                        label: 'Power Distribution (%)',
                        data: powerData,
                        fill: true, // Creates a shaded area under the line
                        backgroundColor: 'rgba(53, 162, 235, 0.2)',
                        borderColor: 'rgba(53, 162, 235, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true, ticks: { stepSize: 10 } }
                    }
                }
            });
        }

        // Call setupCharts on page load
        window.onload = setupCharts;
    </script>
</head>
<body>
    <h1>10GHz EME Stations Statistics</h1>
    <h2>Antenna Size Distribution</h2>
    <canvas id="antennaChart" width="400" height="200"></canvas>
    <h2>Power Distribution</h2>
    <canvas id="powerChart" width="400" height="200"></canvas>
</body>
</html>
