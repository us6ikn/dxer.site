<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10GHz EME Stations Statistics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script> <!-- Annotation Plugin -->
    <script>
        // Fetch data from JSON files
        async function fetchData(file) {
            const response = await fetch(file);
            return await response.json();
        }

        // Function to extract antenna size (m) from antenna description
        function getAntennaSize(antennaStr) {
            let regex = /(\d+(\.\d+)?)(m|ft)/;
            let match = antennaStr.match(regex);
            if (match) {
                return parseFloat(match[1]);
            }
            return 0; // Default if no size is found
        }

        // Function to extract power (in W) from power description
        function getPower(powerStr) {
            let regex = /(\d+)(W|w)/;
            let match = powerStr.match(regex);
            if (match) {
                return parseInt(match[1]);
            }
            return 0; // Default if no power is found
        }

        // Helper function to compute the distribution of values (binned into ranges)
        // Helper function to compute the distribution of values (binned into ranges)
        // Helper function to compute the distribution of antenna sizes
        function computeAntennaBinnedDistribution(values) {
            let bins = {};
            values.forEach(value => {
                let bin;
                if (value >= 0.3 && value < 0.8) {
                    bin = Math.floor(value / 0.5) * 0.5;  // Bins from 0.3m to 0.8m
                } else if (value >= 0.8 && value < 1.0) {
                    bin = Math.floor(value / 0.5) * 0.5;  // Bins from 0.8m to 1m
                } else if (value >= 1.0 && value < 1.5) {
                    bin = Math.floor(value / 0.5) * 0.5;  // Bins from 1m to 1.5m
                } else {
                    bin = Math.floor(value / 1) * 1;  // Larger antennas beyond 1.5m
                }

                bins[bin] = (bins[bin] || 0) + 1;
            });

            let total = values.length;
            let binnedDistribution = [];
            for (let bin in bins) {
                let percentage = (bins[bin] / total) * 100;
                binnedDistribution.push({ bin: parseFloat(bin), percentage });
            }

            return binnedDistribution.sort((a, b) => a.bin - b.bin);
        }
        // Helper function to compute the distribution of power values (binned into ranges)
        function computePowerBinnedDistribution(values) {
            let bins = {};
            values.forEach(value => {
                let bin;
                if (value >= 3 && value < 10) {
                    bin = Math.floor(value / 5) * 5;  // Bins from 3W to 10W in 5W increments
                } else if (value >= 10 && value < 25) {
                    bin = Math.floor(value / 5) * 5;  // Bins from 10W to 25W in 5W increments
                } else if (value >= 25 && value < 50) {
                    bin = Math.floor(value / 25) * 25;  // Bins from 25W to 50W in 25W increments
                } else {
                    bin = Math.floor(value / 50) * 50;  // Bins from 50W and beyond
                }

                bins[bin] = (bins[bin] || 0) + 1;
            });

            let total = values.length;
            let binnedDistribution = [];
            for (let bin in bins) {
                let percentage = (bins[bin] / total) * 100;
                binnedDistribution.push({ bin: parseFloat(bin), percentage });
            }

            return binnedDistribution.sort((a, b) => a.bin - b.bin);
        }



        // Setup the charts
        async function setupCharts() {
            // Load the two JSON files
            let data1 = await fetchData('output_2_10GHz.json');
            let data2 = await fetchData('output_2_10GHz_SK.json');
            let allData = [...data1, ...data2];

            // Get antenna sizes and power values
            let antennaSizes = allData.map(item => getAntennaSize(item.Antenna));
            let powerValues = allData.map(item => getPower(item.Power));

            // Log the extracted values to the console
            console.log("Extracted Antenna Sizes (m):", antennaSizes);
            console.log("Extracted Power Values (W):", powerValues);

            // Compute binned distributions (for antenna size binning)
            let antennaDistribution = computeAntennaBinnedDistribution(antennaSizes);

            // Compute binned distributions (for power size binning)
            let powerDistribution = computePowerBinnedDistribution(powerValues);

            // Prepare chart data for antenna size
            let antennaLabels = antennaDistribution.map(item => `${item.bin}m`);
            let antennaData = antennaDistribution.map(item => item.percentage);

            // Prepare chart data for power distribution
            let powerLabels = powerDistribution.map(item => `${item.bin}W`);
            let powerData = powerDistribution.map(item => item.percentage);

            // Antenna Size Distribution Chart
            new Chart(document.getElementById('antennaChart'), {
                type: 'line',
                data: {
                    labels: antennaLabels,
                    datasets: [{
                        label: 'Antenna Size Distribution (%)',
                        data: antennaData,
                        fill: true, // Creates a shaded area under the line
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Antenna Size (m)'
                            }
                        },
                        y: {
                            beginAtZero: false,
                            ticks: { stepSize: 10 }
                        }
                    }
                }
            });

            // Power Distribution Chart
            new Chart(document.getElementById('powerChart'), {
                type: 'line',
                data: {
                    labels: powerLabels,
                    datasets: [{
                        label: 'Power Distribution (%)',
                        data: powerData,
                        fill: true, // Creates a shaded area under the line
                        backgroundColor: 'rgba(53, 162, 235, 0.2)',
                        borderColor: 'rgba(53, 162, 235, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Power (W)'
                            }
                        },
                        y: {
                            beginAtZero: false,
                            ticks: { stepSize: 10 }
                        }
                    }
                }
            });
        }


        // Call setupCharts on page load
        window.onload = setupCharts;
    </script>
</head>
<body>
    <h1>10GHz EME Stations Statistics</h1>
    <h2>Antenna Size Distribution</h2>
    <canvas id="antennaChart" width="400" height="200"></canvas>
    <h2>Power Distribution</h2>
    <canvas id="powerChart" width="400" height="200"></canvas>
</body>
</html>
