<!DOCTYPE html>
<html>
  <head>
    <title>GreenCube Observer</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      #map {
        height: 95%;
      }
      html, body {
        height: 100%;
        marginx: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <input type="text" id="grid-locator" placeholder="Enter Grid Locator">
    <button onclick="drawCircle()">Draw Circle</button>
    <script>
      function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 2,
          center: { lat: 0, lng: 0 }
        });

        const infowindow = new google.maps.InfoWindow();

        fetch("output_filtered.txt")
          .then(response => response.text())
          .then(data => {
            const regex = /Callsign: ([A-Z0-9\/]+), Grid locator: ([A-Z0-9]+), Coordinates: \(([-0-9.]+), ([-0-9.]+)\)/g;
            const callsigns = {};
            let match;
            while ((match = regex.exec(data)) !== null) {
              const callsign = match[1];
              const lat = parseFloat(match[3]);
              const lng = parseFloat(match[4]);
              const key = `${lat},${lng}`;
              if (!callsigns[key]) {
                callsigns[key] = [];
              }
              callsigns[key].push(callsign);
            }
            for (const key in callsigns) {
              const [lat, lng] = key.split(",");
              const marker = new google.maps.Marker({
                position: { lat: parseFloat(lat), lng: parseFloat(lng) },
                map: map,
                title: callsigns[key].join(", "),
                icon: {
                  url: "https://dxer.site/test/ac.png",
                  scaledSize: new google.maps.Size(20, 20)
                }
              });
              marker.addListener("click", () => {
                infowindow.setContent(callsigns[key].join(", "));
                infowindow.open(map, marker);
              });
            }
          });

        // Define a circle object with a 13000 km radius
        const circle = new google.maps.Circle({
          strokeColor: "#FF0000",
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: "#FF0000",
          fillOpacity: 0.35,
          map,
          center: { lat: 0, lng: 0 },
          radius: 13000000,
        });

        // Function to draw circle around grid locator
        window.drawCircle = function() {
          // Get the grid locator from user input and convert to uppercase
          var gridLocator = document.getElementById("grid-locator").value.toUpperCase();

          // Force the first two characters to be uppercase
          gridLocator = gridLocator.substr(0,2).toUpperCase() + gridLocator.substr(2);

          // Force the last two characters to be lowercase
          gridLocator = gridLocator.substr(0,4) + gridLocator.substr(4).toLowerCase();

          // Use regular expression to validate the grid locator format
          var gridLocatorPattern = /^([A-R]{2}\d{2
              // Create a circle with 13000 km radius around the marker
              var circle = new google.maps.Circle({
              strokeColor: "#FF0000",
              strokeOpacity: 0.8,
              strokeWeight: 2,
              fillColor: "#FF0000",
              fillOpacity: 0.35,
              map: map,
              center: marker.getPosition(),
              radius: 13000000 // 13000 km in meters
              });
              }
              </script>
              <style>
              #map {
              height: 400px;
              width: 100%;
              }
              </style>

              </head>
              <body>
                  <h1>Enter a grid locator to center the map on</h1>
                  <p>Example: JO89, JO89GA</p>
                  <input type="text" id="grid-locator" />
                  <button onclick="initMap()">Show Map</button>
                  <div id="map"></div>
              </body>
              </html>
