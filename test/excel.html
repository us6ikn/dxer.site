<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Moon Circumstances Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    label, input {
      margin-bottom: 8px;
      display: block;
    }
    .output {
      margin-top: 20px;
    }
    .output div {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1>Moon Circumstances Calculator</h1>
  <form id="moonForm">
    <label>Year: <input type="number" id="year" value="2024"></label>
    <label>Month: <input type="number" id="month" value="11"></label>
    <label>Day (UT): <input type="number" id="day" value="30"></label>
    <label>Hour (UT): <input type="number" id="hour" value="20"></label>
    <label>Minute: <input type="number" id="minute" value="38"></label>
    <label>Longitude (East +): <input type="number" step="any" id="longitude" value="17.6507"></label>
    <label>Latitude (North +): <input type="number" step="any" id="latitude" value="59.8015"></label>
    <button type="button" onclick="calculateMoonData()">Calculate</button>
  </form>

  <div class="output" id="output"></div>

  <script>
    function deg2rad(deg) {
      return deg * Math.PI / 180;
    }

    function rad2deg(rad) {
      return rad * 180 / Math.PI;
    }

    function normalizeAngle(angle) {
      return (angle % 360 + 360) % 360;
    }

    function calculateJulianDate(year, month, day, hour, minute) {
      if (month <= 2) {
        year--;
        month += 12;
      }
      const A = Math.floor(year / 100);
      const B = 2 - A + Math.floor(A / 4);
      const dayFraction = (hour + minute / 60) / 24;
      return Math.floor(365.25 * (year + 4716)) +
             Math.floor(30.6001 * (month + 1)) +
             day + dayFraction + B - 1524.5;
    }

    function calculateMoonData() {
      const year = parseInt(document.getElementById('year').value);
      const month = parseInt(document.getElementById('month').value);
      const day = parseInt(document.getElementById('day').value);
      const hour = parseInt(document.getElementById('hour').value);
      const minute = parseInt(document.getElementById('minute').value);
      const lon = parseFloat(document.getElementById('longitude').value);
      const lat = parseFloat(document.getElementById('latitude').value);

      const JD = calculateJulianDate(year, month, day, hour, minute);
      const T = (JD - 2451545.0) / 36525.0;

      // Mean elongation of the Moon
      const D = deg2rad(normalizeAngle(297.8501921 + 445267.1114034 * T - 0.0018819 * T*T + T*T*T / 545868 - T*T*T*T / 113065000));

      // Sun's mean anomaly
      const M = deg2rad(normalizeAngle(357.5291092 + 35999.0502909 * T - 0.0001536 * T*T + T*T*T / 24490000));

      // Moon's mean anomaly
      const Mp = deg2rad(normalizeAngle(134.9633964 + 477198.8675055 * T + 0.0087414 * T*T + T*T*T / 69699 - T*T*T*T / 14712000));

      // Moon's argument of latitude
      const F = deg2rad(normalizeAngle(93.2720950 + 483202.0175233 * T - 0.0036539 * T*T - T*T*T / 3526000 + T*T*T*T / 863310000));

      // Longitude of the ascending node of the Moon
      const Omega = deg2rad(normalizeAngle(125.0445479 - 1934.1362891 * T + 0.0020754 * T*T + T*T*T / 467441 - T*T*T*T / 60616000));

      // Ecliptic latitude (approximate)
      const beta = 5.128 * Math.sin(F);

      // Moon's longitude (mean longitude + equation of center)
      const Lm = normalizeAngle(218.316 + 13.176396 * (JD - 2451545.0)); // mean longitude
      const lambda = normalizeAngle(Lm + 6.289 * Math.sin(Mp));

      // Sun's longitude (mean + equation of center)
      const Ls = normalizeAngle(280.466 + 36000.77 * T); // mean
      const lambda_sun = normalizeAngle(Ls + 1.915 * Math.sin(M) + 0.020 * Math.sin(2 * M));

      // Geocentric librations
      const Bo = beta;
      const Lo = normalizeAngle(lambda - lambda_sun - 180);

      // Colongitude
      const colong = normalizeAngle(lambda_sun + 180 - lambda);

      // Output rendering
      document.getElementById('output').innerHTML = `
        <div><strong>Julian Date:</strong> ${JD.toFixed(5)}</div>
        <div><strong>Geocentric Libration in Latitude (Bo):</strong> ${Bo.toFixed(1)}°</div>
        <div><strong>Geocentric Libration in Longitude (Lo):</strong> ${Lo.toFixed(1)}°</div>
        <div><strong>Colongitude of the Sun:</strong> ${colong.toFixed(1)}°</div>
      `;
    }
  </script>
</body>
</html>
