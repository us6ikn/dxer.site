<!DOCTYPE html>
<html>
  <script
    type="text/javascript"
    src="https://platform-api.sharethis.com/js/sharethis.js#property=6408717eb20f5f00192a0d72&product=inline-share-buttons&source=platform"
    async="async"
  ></script>
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-7YST3WTEH3"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-7YST3WTEH3");
    </script>
    <!-- Include Font Awesome CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <meta
      name="viewport"
      content="initial-scale=1.0, user-scalable=no"
    />
    <meta name="description" content="QO-100 SAT Observer" />
    <meta name="author" content="https://dxer.site" />
    <meta charset="utf-8" />
    <title>QO-100 Satellite Observer</title>
    <style>
      html,
      body {
        height: 100%;
        padding: 0;
        margin: 0;
      }
      #map {
        height: 100%;
      }
    </style>
    <style>
      .twitter-container {
        position: fixed;
        bottom: 60px;
        left: 15px;
        z-index: 9999;
      }

      .twitter-follow-button {
        display: inline-block;
        background-color: #1da1f2;
        color: #fff;
        padding: 4px 8px;
        border-radius: 16px;
        font-weight: bold;
        text-decoration: none;
      }
      .floating {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 1000;
        background-color: rgba(255, 255, 255, 0.8);
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
        opacity: 1.0;
      }
      .checkbox-container {
        display: flex;
        flex-direction: row;
      }

      .floating-button {
        position: absolute;
        bottom: 160px;
        left: 8px;
        z-index: 999;
      }

      .floating-button-icon {
        font-size: 30px;
        /* Adjust the size of the icon as needed */
        color: #808080;
        /* Adjust the color of the icon as needed */
        padding: 10px;
        /* Add padding around the icon as needed */
        background-color: rgba(255, 255, 255, 0.0);
        /* Add background color to the icon as needed */
        border-radius: 50%;
        /* Apply border radius to create a circular button */
      }

      .floating-window {
        position: fixed;
        bottom: 350px;
        right: 60px;
        z-index: 9999;
      }

      .toggle-button {
        position: absolute;
        top: 45px;
        right: 0;
        width: 20px;
        height: 20px;
        font-size: 20px;
        font-weight: bold;
        text-align: center;
        color: transparent;
        background-color: transparent;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        opacity: 0;
      }

      .arrow-button {
        position: absolute;
        top: 47px;
        left: -22;
        width: 20px;
        height: 20px;
        font-size: 20px;
        font-weight: bold;
        text-align: center;
        color: black;
        background-color: transparent;
        border: none;
        cursor: pointer;
        opacity: 1;
      }

      .content {
        position: absolute;
        top: 0;
        right: -280px;
        width: 220px;
        padding: 10px;
        background-color: rgba(255, 255, 255, 0.8);
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
        transition: right 0.5s;
        z-index: -1;
      }

      .show {
        right: 0;
        z-index: 9999;
      }

      .blinking-marker {
        background-image: url(img/rover.gif);
        width: 20px;
        height: 20px;
        background-position: 0 0;
        animation: blink 1s steps(2) infinite;
      }

      @keyframes blink {
        50% {
          background-position: -32px 0;
        }
      }
    </style>
    <style>
      * {
        outline: none !important;
      }
    </style>
  </head>
  <body>
    <div class="floating">
      <label style="font-size: 14px;" for="grid-locator"
        >Enter Grid:</label
      >
      <input
        type="text"
        id="grid-locator"
        placeholder="e.g. JO89tt"
        maxlength="6"
        style="width: 68px;"
      />
      <button
        onclick="initMap(document.getElementById('grid-locator').value); document.getElementById('kml-layer-toggle').checked = false;"
      >
        Plot LEO+MEO Range
      </button>
      <div
        class="checkbox-container"
        style="display: flex; align-items: center;"
      >
        <input
          type="checkbox"
          style="margin-top: 10px;"
          id="kml-layer-toggle"
        />
        <label for="kml-layer-toggle" style="margin-top: 14px; font-size: 14px;"
          >CQ Zones</label
        >
        <img
          src="img/qo100logo.png"
          alt="QO-100 SAT Observer logo"
          style="vertical-align: middle; margin-left: 4px; width: 20px;"
        />
        <span
          style="
            position: relative;
            display: inline-block;
            font-family: Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            letter-spacing: 1px;
            margin-left: 5px;
            margin-top: 10px;
          "
        >
          QO-100 Satellite Observer
          <sup
            style="
              position: absolute;
              top: -7px;
              right: 0;
              font-size: 9px;
              font-family: Arial, sans-serif;
              font-weight: normal;
              letter-spacing: 0px;
            "
            >by SA5IKN</sup
          >
        </span>
      </div>
    </div>

    <a
      href="https://dxer.site"
      target="_blank"
      class="floating-button"
    >
      <i class="fas fa-home floating-button-icon"></i>
    </a>
    <a
      href="https://dxer.site/greencube-observer.html"
      style="
        position: fixed;
        bottom: 135px;
        left: 15px;
        color: gray;
        font-family: Arial;
        font-size: 28px;
        z-index: 9999;
        font-weight: bold;
      "
      >MEO</a
    >
    <a
      href="https://dxer.site/leo-satellite-observer.html"
      style="
        position: fixed;
        bottom: 100px;
        left: 15px;
        color: gray;
        font-family: Arial;
        font-size: 28px;
        z-index: 9999;
        font-weight: bold;
      "
      >LEO</a
    >

    <div class="floating-window">
      <button class="toggle-button"></button>
      <button
        class="arrow-button"
        onclick="toggleFloatingWindow()"
        >&#x25b6;</button
      >
      <div class="content">
        <div><img src="img/cw_30.png" alt="" style="width: 15px; height: 15px;" /> CW station</div>
        <div><img src="img/ssb.png" alt="" style="width: 15px; height: 15px;" /> SSB station</div>
        <div><img src="img/FT8.png" alt="" style="width: 15px; height: 15px;" /> FT8 station</div>
        <div>
          <p style="font-size: smaller;">
            &nbsp;&nbsp;&nbsp;&nbsp;Data sources (with permission): <br />
            &nbsp;&nbsp;&nbsp;&nbsp;CW -
            <a href="https://twitter.com/flo_0_">DF2ET CW Skimmer</a
            ><br />
            &nbsp;&nbsp;&nbsp;&nbsp;FT8 -
            <a href="http://ft8-dash.ike.net.br">PU3IKE FT8 Skimmer</a
            ><br />
            &nbsp;&nbsp;&nbsp;&nbsp;SSB - DX Cluster <br />
            &nbsp;&nbsp;&nbsp;&nbsp;Location data:
            <a href="http://hamqth.com">HamQTH.com</a>
          </p>
        </div>
        <div class="sharethis-inline-share-buttons"></div>
      </div>
    </div>

    <div id="map"></div>
    <script>
      var map;
      var kmlLayer;
      var circles = [];

      function calculateCoordinates(gridLocator) {
        // Get the grid locator from user input and convert to uppercase
        var gridLocator = gridLocator.toUpperCase();

        // Check if the grid locator is valid
        if (!isValidGridLocator(gridLocator)) {
          alert("Invalid grid locator!");
          return;
        }

        // Get the latitude and longitude from the grid locator
        var latitude = gridLocatorToLatitude(gridLocator);
        var longitude = gridLocatorToLongitude(gridLocator);

        // Calculate the coordinates for the range circles
        var coordinates = [];
        for (var i = 1; i <= 5; i++) {
          coordinates.push(calculateCircleCoordinates(latitude, longitude, i * 1000));
        }

        return coordinates;
      }

      function isValidGridLocator(gridLocator) {
        // Check if the grid locator has 6 characters
        if (gridLocator.length !== 6) {
          return false;
        }

        // Check if the grid locator contains only valid characters
        var regex = /^[A-R]{2}[0-9]{2}[A-X]{2}$/;
        return regex.test(gridLocator);
      }

      function gridLocatorToLatitude(gridLocator) {
        var latitudeIndex = gridLocator.charAt(1).charCodeAt(0) - 65;
        var latitudeSquare = latitudeIndex * 20 - 90;
        var latitudeSubSquare = parseInt(gridLocator.charAt(3)) * 2;
        var latitudeSubSquareMidpoint = latitudeSubSquare + 1;
        var latitudeSquareMidpoint = latitudeSquare + 10;
        var latitudeIncrement = 2.0 / 24.0;

        return (
          latitudeSquareMidpoint +
          latitudeSubSquareMidpoint * latitudeIncrement
        );
      }

      function gridLocatorToLongitude(gridLocator) {
        var longitudeIndex = gridLocator.charAt(0).charCodeAt(0) - 65;
        var longitudeSquare = longitudeIndex * 20 - 180;
        var longitudeSubSquare = parseInt(gridLocator.charAt(2)) * 5;
        var longitudeSubSquareMidpoint = longitudeSubSquare + 2.5;
        var longitudeSquareMidpoint = longitudeSquare + 10;
        var longitudeIncrement = 5.0 / 24.0;

        return (
          longitudeSquareMidpoint +
          longitudeSubSquareMidpoint * longitudeIncrement
        );
      }

      function calculateCircleCoordinates(latitude, longitude, radius) {
        var coordinates = [];

        for (var i = 0; i < 360; i += 10) {
          var angle = (i * Math.PI) / 180;
          var x = radius * Math.cos(angle);
          var y = radius * Math.sin(angle);

          var latlng = new google.maps.LatLng(
            latitude + (y / 111.2),
            longitude + (x / (111.2 * Math.cos(latitude * (Math.PI / 180))))
          );

          coordinates.push(latlng);
        }

        return coordinates;
      }

      function initMap(gridLocator) {
        var coordinates = calculateCoordinates(gridLocator);

        if (!coordinates) {
          return;
        }

        // Initialize the map
        map = new google.maps.Map(document.getElementById("map"), {
          center: coordinates[0][0],
          zoom: 8,
          streetViewControl: false,
        });

        // Add the range circles to the map
        circles = [];
        for (var i = 0; i < coordinates.length; i++) {
          var circle = new google.maps.Polygon({
            paths: coordinates[i],
            strokeColor: "#FF0000",
            strokeOpacity: 0.8,
            strokeWeight: 1,
            fillColor: "#FF0000",
            fillOpacity: 0.2,
            clickable: false,
          });
          circles.push(circle);
          circle.setMap(map);
        }

        // Add the KML layer for CQ zones
        kmlLayer = new google.maps.KmlLayer({
          url: "https://dxer.site/cq-zones.kml",
          suppressInfoWindows: true,
          preserveViewport: true,
        });

        // Toggle the KML layer based on checkbox state
        var kmlLayerToggle = document.getElementById("kml-layer-toggle");
        kmlLayerToggle.addEventListener("change", function () {
          if (kmlLayerToggle.checked) {
            kmlLayer.setMap(map);
          } else {
            kmlLayer.setMap(null);
          }
        });

        // Fit the map bounds to the range circles
        var bounds = new google.maps.LatLngBounds();
        for (var i = 0; i < circles.length; i++) {
          for (var j = 0; j < circles[i].getPath().getLength(); j++) {
            bounds.extend(circles[i].getPath().getAt(j));
          }
        }
        map.fitBounds(bounds);
      }

      function toggleFloatingWindow() {
        var toggleButton = document.querySelector(".toggle-button");
        var arrowButton = document.querySelector(".arrow-button");
        var content = document.querySelector(".content");

        if (toggleButton.classList.contains("show")) {
          toggleButton.classList.remove("show");
          toggleButton.style.opacity = 0;
          arrowButton.style.opacity = 1;
          content.style.right = "-280px";
        } else {
          toggleButton.classList.add("show");
          toggleButton.style.opacity = 1;
          arrowButton.style.opacity = 0;
          content.style.right = "0";
        }
      }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPRWRoTRhE5TddxBITIhBcKjdQpz2CXRs&callback=initMap"></script>
  </body>
</html>
