<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sortable DXCC Table</title>
<style>
/* Table Styles */
table {
  border-collapse: collapse;
  width: 100%;
  border: 1px solid #dddddd;
}

th, td {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 10px;
}

th {
  cursor: pointer;
  background-color: #f2f2f2;
}

th:hover {
  background-color: #e0e0e0;
}

/* Indicate clickable headers */
.sortable-header:after {
  content: ' â‡…'; /* Unicode for up-down arrow */
  font-size: 0.8em;
  margin-left: 5px;
}

/* Remove arrow content when not sorted */
.sortable-header[data-sorted="false"]:after {
  content: none;
}
</style>
</head>
<body>

<table id="dxccTable">
  <thead>
    <tr>
      <th data-column="0" class="sortable-header" onclick="sortTable(0)">DXCC</th>
      <th data-column="1" class="sortable-header" onclick="sortTable(1)">First heard</th>
      <th data-column="2" class="sortable-header" onclick="sortTable(2)">Last heard</th>
    </tr>
  </thead>
  <tbody>
    <!-- Data will be loaded here -->
  </tbody>
</table>

<script>
let sortingOrder = [1, 1, 1]; // Initial sorting order for each column

function sortTable(columnIndex) {
  const table = document.getElementById("dxccTable");
  const rows = Array.from(table.rows).slice(1); // Exclude header row
  const isDateColumn = columnIndex === 1 || columnIndex === 2;
  sortingOrder[columnIndex] *= -1; // Toggle sorting order
  rows.sort((a, b) => {
    const aValue = isDateColumn ? new Date(a.cells[columnIndex].textContent) : a.cells[columnIndex].textContent.toLowerCase();
    const bValue = isDateColumn ? new Date(b.cells[columnIndex].textContent) : b.cells[columnIndex].textContent.toLowerCase();
    if (aValue < bValue) return -1 * sortingOrder[columnIndex];
    if (aValue > bValue) return 1 * sortingOrder[columnIndex];
    return 0;
  });
  while (table.rows.length > 1) {
    table.deleteRow(1);
  }
  rows.forEach(row => {
    table.appendChild(row);
  });

  // Update data-sorted attribute for styling
  const headers = table.querySelectorAll('th');
  headers.forEach((header, index) => {
    header.setAttribute('data-sorted', index === columnIndex ? sortingOrder[columnIndex] > 0 : false);
  });
}
</script>

<script>
// Fetch data from the file and populate the table
fetch('out_dxcc_stats.txt')
  .then(response => response.text())
  .then(data => {
    const tableBody = document.querySelector('#dxccTable tbody');
    const lines = data.trim().split('\n');
    lines.forEach(line => {
      const [_, dxcc, earliest, latest] = line.match(/DXCC: (.*), Earliest: (.*)\, Latest: (.*)/);
      const row = document.createElement('tr');
      row.innerHTML = `<td>${dxcc}</td><td>${earliest.replace('T', ' ')}</td><td>${latest.replace('T', ' ')}</td>`;
      tableBody.appendChild(row);
    });
  })
  .catch(error => {
    console.error('Error fetching data:', error);
  });
</script>

</body>
</html>
